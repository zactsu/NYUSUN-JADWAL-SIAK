<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyusun Jadwal by Lookman</title>
    <style>
        :root {
            --primary-color: #4A4E69; --secondary-color: #9A8C98; --background-color: #F2E9E4;
            --card-bg-color: #FFFFFF; --text-color: #22223B; --border-color: #C9ADA7; --header-bg: #6D6A75;
            --danger-color: #c94f4f; --success-color: #2a9d8f;
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 0; }
        .page-header { text-align: center; padding: 20px; font-size: 2em; color: var(--primary-color); }
        .container { max-width: 1200px; margin: auto; padding: 0 20px 20px 20px; }
        .page-footer { text-align: center; padding: 20px; margin-top: 40px; font-size: 0.9em; color: var(--secondary-color); border-top: 1px solid var(--border-color); }
        .tab-nav { display: flex; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; background: var(--background-color); }
        .tab-button { flex: 1; padding: 15px; border: none; background-color: var(--card-bg-color); color: var(--primary-color); font-size: 1em; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        .tab-button + .tab-button { border-left: 1px solid var(--border-color); }
        .tab-button.active { background-color: var(--primary-color); color: white; }
        .tab-button:not(.active):hover { background-color: #e9e2de; }
        .view-container { display: none; }
        .view-container.active { display: block; }
        .pilih-matkul-layout { display: flex; gap: 20px; align-items: flex-start; }
        #left-panel { flex: 2; }
        /* #right-panel global dihapus karena akan diatur oleh media query */
        h2 { font-size: 1.5em; text-align: left; border: none; padding: 0; margin: 0; }
        .summary-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; }
        #reset-button { background-color: transparent; color: var(--danger-color); border: 1px solid var(--danger-color); border-radius: 5px; padding: 5px 10px; font-size: 0.8em; font-weight: bold; cursor: pointer; }
        #reset-button:hover { background-color: var(--danger-color); color: white; }
        .course-card { background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; padding: 15px; }
        .course-header { font-size: 1.1em; font-weight: bold; margin-bottom: 5px; }
        .course-subheader { font-size: 0.85em; color: #555; margin-bottom: 10px; }
        .class-item { padding: 10px 0; border-top: 1px dashed var(--border-color); display: flex; align-items: flex-start; }
        .class-item:first-of-type { border-top: none; }
        .class-info { margin-left: 10px; flex-grow: 1; }
        .class-info strong { display: block; }
        .class-info .details { font-size: 0.9em; color: #555; display: block; margin-top: 4px; line-height: 1.6; }
        #selected-classes-panel { background-color: var(--card-bg-color); border-radius: 8px; padding: 15px; border: 1px solid var(--border-color); }
        #selected-list-header, .selected-item, #selected-list-footer {
            display: grid;
            grid-template-columns: 3fr 2.5fr 1.5fr 0.5fr;
            gap: 2px;
            align-items: center;
            font-size: 0.9em;
        }
        #selected-list-header {
            padding-bottom: 10px;
            padding-top: 5px;
            border-bottom: 1px solid var(--border-color);
            font-weight: bold;
        }
        #selected-list-content { margin-top: 10px; max-height: 40vh; overflow-y: auto; scrollbar-gutter: stable; }
        .selected-item {
            padding: 12px 4px;
            border-bottom: 1px dashed var(--border-color);
        }
        .selected-item:last-child { border-bottom: none; }
        .selected-item span:nth-child(3){ text-align: center; }
        .selected-item span:nth-child(4) { text-align: center; }
        .remove-btn {
            color: var(--danger-color);
            font-weight: bold;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
            display: inline-block;
        }
        .remove-btn:hover { background-color: #fce8e8; }
        #selected-list-footer {
            padding: 15px 20px;
            margin: 15px -15px -15px -15px;
            background-color: #333;
            color: white;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            font-weight: bold;
            padding-left: 20px;
        }
        #summary-sks-total { text-align: left; grid-column: 3 / 4; margin-left: 10px; }
        .list-table { width: 100%; border-collapse: collapse; background-color: var(--card-bg-color); border-radius: 8px; overflow: hidden; }
        .list-table th, .list-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .list-table th { background-color: var(--header-bg); color: white; font-size: 0.9em; text-transform: uppercase; text-align: center; }
        .list-table th + th { border-left: 1px solid rgba(255, 255, 255, 0.2); }
        .list-table tfoot td { font-weight: bold; font-size: 1.1em; background-color: #333; color: white; border-bottom: none;}
        .list-table td { font-size: 0.95em; line-height: 1.5; }
        .list-table th:nth-child(5),
        .list-table td:nth-child(5) { text-align: center; }
        #timetable { display: grid; grid-template-columns: 60px repeat(6, 1fr); grid-template-rows: 40px repeat(90, 8px); background-color: var(--card-bg-color); border-radius: 8px; border: 1px solid var(--border-color); position: relative; gap: 0 2px; row-gap: 0; overflow: hidden;}
        .grid-header { background-color: var(--header-bg); color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 0.9em; border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); }
        .grid-header:last-child { border-right: none; }
        .time-slot { font-size: 0.8em; font-weight: bold; background-color: var(--header-bg); color: white; display: flex; align-items: center; justify-content: center; margin-bottom: -1px;}
        .schedule-block { background-color: #a99ca1; color: white; border-radius: 4px; padding: 5px; font-size: 0.8em; overflow: hidden; z-index: 10; }
        .block-time { font-weight: bold; font-size: 0.9em; margin-bottom: 3px; }
        .block-classname { margin-bottom: 3px; }
        .block-room { font-size: 0.9em; opacity: 0.9; }
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: none; align-items: center; justify-content: center; z-index: 1000; }
        #modal { background-color: var(--card-bg-color); padding: 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px; text-align: center; }
        #modal-title { font-size: 1.4em; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        #modal-message { font-size: 1em; color: var(--text-color); margin-bottom: 20px; line-height: 1.5; }
        #modal-footer { display: flex; justify-content: center; gap: 10px; }
        .modal-button { padding: 10px 20px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; transition: opacity 0.2s; }
        .modal-button:hover { opacity: 0.8; }
        #modal-btn-confirm { background-color: var(--danger-color); color: white; }
        #modal-btn-ok { background-color: var(--primary-color); color: white; }
        #modal-btn-cancel { background-color: #ccc; color: #333; }
        #list-sks-total { text-align: center; }
        .info-bar {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
        }
        .info-bar strong { color: var(--primary-color); }
        #open-sidebar-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1001;
            transition: transform 0.2s;
        }
        #open-sidebar-btn:hover { transform: scale(1.1); }
        #close-sidebar-btn { display: none; }

        .controls-container {
    display: flex;
    justify-content: space-between; /* Mendorong item ke kiri dan kanan */
    align-items: stretch; /* Membuat tinggi item sama */
    gap: 20px;
    margin-bottom: 0px; /* Jarak ke konten di bawahnya */
}

/* Mengatur Info Bar di sisi kiri */
.info-bar {
    flex-grow: 0.65; /* Biarkan info bar memanjang */
    display: flex;
    flex-direction: column; /* Menyusun Major & Periode ke bawah */
    justify-content: center;
    line-height: 1.6;
    align-items: flex-start;
    padding-left: 20px;
}

/* Wadah untuk tombol reset di kanan */
.reset-control {
    flex-shrink: 0; /* Mencegah tombol menyusut */
    flex: 1;
}

/* Styling Tombol "Reset script" */
#reset-script-btn {
    width: 100%;
    height: 78%; /* Membuat tinggi tombol sama dengan info bar */
    padding: 12px 24px;
    font-size: 1em;
    font-weight: bold;
    color: var(--danger-color);
    background-color: var(--card-bg-color);
    border: 2px solid var(--danger-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

#reset-script-btn:hover {
    background-color: var(--danger-color);
    color: white;
}

        /* === PERBAIKAN CSS UNTUK DESKTOP (LAYAR LEBAR) === */
        @media (min-width: 846px) {
            #right-panel {
                flex: 1;
                position: sticky;
                top: 80px;
            }
        }

        /* === PERBAIKAN CSS UNTUK MOBILE (LAYAR KECIL) === */
        @media (max-width: 845px) {
            .pilih-matkul-layout {
                flex-direction: column;
            }
            #left-panel {
                width: 100%;
            }
            .info-bar {
                overflow-x: auto;
                white-space: nowrap;
                justify-content: flex-start;
                gap: 25px;
            }
            #right-panel {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                z-index: 999;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s, visibility 0.3s;
                overflow-x: auto;
            }
            #right-panel.sidebar-open {
                opacity: 1;
                visibility: visible;
            }
            #selected-classes-panel {
                width: 90%;
                max-width: 400px;
                transform: translateY(20px);
                opacity: 0;
                transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            }
            #right-panel.sidebar-open #selected-classes-panel {
                transform: translateY(0);
                opacity: 1;
            }
            #close-sidebar-btn {
                display: block;
                background: none; border: none; font-size: 28px;
                color: var(--primary-color); cursor: pointer;
                order: 3;
            }
            .summary-header h2 { flex-grow: 1; text-align: left; }
            #selected-list-header span:nth-child(3),
            .selected-item span:nth-child(3) {
                text-align: center;
            }

            #summary-sks-total {
                text-align: center;
                grid-column: 3 / 4;
                margin: 0;
            }
            #reset-button { order: 2; margin: 0 10px; }
            #calendar-view, #list-view { overflow-x: auto; }
            #timetable { width: 800px; }
        }
    </style>
</head>
<body>

    <div id="modal-overlay">
        <div id="modal">
            <div id="modal-title">Judul Notifikasi</div>
            <div id="modal-message">Isi pesan notifikasi.</div>
            <div id="modal-footer">
                <button id="modal-btn-confirm" class="modal-button">Ya, Hapus</button>
                <button id="modal-btn-cancel" class="modal-button">Batal</button>
                <button id="modal-btn-ok" class="modal-button">OK</button>
            </div>
        </div>
    </div>

    <header class="page-header">Nyusun Jadwal by Lookman</header>

    <div class="container">
        <div class="tab-nav">
            <button id="btn-pilih-view" class="tab-button active">Pilih Matkul</button>
            <button id="btn-list-view" class="tab-button">List Matkul</button>
            <button id="btn-calendar-view" class="tab-button">Kalender Matkul</button>
        </div>
        <div class="controls-container">
            <div class="info-bar">
                <span><strong>Major:</strong> Teknik Elektro</span>
                <span><strong>Periode:</strong> 2024/2025 - Ganjil</span>
            </div>
            <div class="reset-control">
                <button id="reset-script-btn">Reset script</button>
            </div>
        </div>

        <div id="pilih-view" class="view-container active">
            <div class="pilih-matkul-layout">
                <div id="left-panel">
                    <div id="course-list"><p>Memuat data mata kuliah...</p></div>
                </div>
                
                <div id="right-panel">
                    <div id="selected-classes-panel">
                        <div class="summary-header">
                            <h2>Kelas Pilihan</h2>
                            <button id="reset-button">Reset</button>
                            <button id="close-sidebar-btn">&times;</button>
                        </div>
                        <div id="selected-list-header">
                            <span>Kelas</span>
                            <span>Waktu</span>
                            <span>SKS</span>
                            <span></span> 
                        </div>
                        <div id="selected-list-content"></div>
                        <div id="selected-list-footer">
                            <span>Total SKS</span>
                            <span></span>
                            <span id="summary-sks-total">0</span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="list-view" class="view-container">
            <table class="list-table">
                <thead><tr><th>Nama Kelas</th><th>Waktu</th><th>Ruang</th><th>Dosen</th><th>SKS</th></tr></thead>
                <tbody id="list-view-body"></tbody>
                <tfoot><tr><td colspan="4">Total SKS</td><td id="list-sks-total">0</td></tr></tfoot>
            </table>
        </div>
        <div id="calendar-view" class="view-container">
            <div id="timetable"></div>
        </div>
    </div>
    
    <footer class="page-footer">Made by Lookman EE'24 with Gemini</footer>

    <button id="open-sidebar-btn" title="Lihat Kelas Pilihan">&lt;</button>

<script>
document.addEventListener('DOMContentLoaded', () => {
    let scrollPositions = {};
    let courseData = [];
    let selectedClasses = JSON.parse(localStorage.getItem('jadwalPilihan')) || [];

    const allViews = document.querySelectorAll('.view-container');
    const allButtons = document.querySelectorAll('.tab-button');
    const courseListContainer = document.getElementById('course-list');
    const summaryContent = document.getElementById('selected-list-content');
    const summarySksTotal = document.getElementById('summary-sks-total');
    const resetButton = document.getElementById('reset-button');
    const listViewBody = document.getElementById('list-view-body');
    const listSksTotal = document.getElementById('list-sks-total');
    const timetableElement = document.getElementById('timetable');

    const modalOverlay = document.getElementById('modal-overlay');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const btnConfirm = document.getElementById('modal-btn-confirm');
    const btnCancel = document.getElementById('modal-btn-cancel');
    const btnOk = document.getElementById('modal-btn-ok');

    const openBtn = document.getElementById('open-sidebar-btn');
    const closeBtn = document.getElementById('close-sidebar-btn');
    const rightPanel = document.getElementById('right-panel');
    const selectedClassesPanel = document.getElementById('selected-classes-panel');

    function openSidebar() {
        rightPanel.classList.add('sidebar-open');
        document.body.style.overflow = 'hidden';
    }

    function closeSidebar() {
        rightPanel.classList.remove('sidebar-open');
        document.body.style.overflow = 'auto'; 
    }

    function updateSidebarButtonVisibility() {
        const isPilihViewActive = document.getElementById('pilih-view').classList.contains('active');
        const isMobile = window.innerWidth <= 845;
        if (isPilihViewActive && isMobile) {
            openBtn.style.display = 'flex';
        } else {
            openBtn.style.display = 'none';
        }
    }

    openBtn.addEventListener('click', openSidebar);
    closeBtn.addEventListener('click', closeSidebar);
    rightPanel.addEventListener('click', closeSidebar);
    selectedClassesPanel.addEventListener('click', (e) => e.stopPropagation());

    function showModal(title, message, type = 'alert') {
        return new Promise(resolve => {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            if (type === 'confirm') {
                btnConfirm.style.display = 'inline-block';
                btnCancel.style.display = 'inline-block';
                btnOk.style.display = 'none';
                btnConfirm.onclick = () => { resolve(true); hideModal(); };
                btnCancel.onclick = () => { resolve(false); hideModal(); };
            } else {
                btnConfirm.style.display = 'none';
                btnCancel.style.display = 'none';
                btnOk.style.display = 'inline-block';
                btnOk.onclick = () => { resolve(true); hideModal(); };
            }
            modalOverlay.style.display = 'flex';
        });
    }

    function hideModal() {
        modalOverlay.style.display = 'none';
    }

    allButtons.forEach(button => {
        button.addEventListener('click', () => {
            const activeView = document.querySelector('.view-container.active');
            if (activeView) { scrollPositions[activeView.id] = window.scrollY; }
            const targetViewId = button.id.replace('btn-', '');
            allButtons.forEach(btn => btn.classList.remove('active'));
            allViews.forEach(view => view.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(targetViewId).classList.add('active');
            window.scrollTo(0, scrollPositions[targetViewId] || 0);
            updateSidebarButtonVisibility();
        });
    });

    resetButton.addEventListener('click', async () => {
        if (selectedClasses.length > 0) {
            const confirmed = await showModal('Reset Pilihan?', 'Anda yakin ingin mereset semua jadwal yang telah dipilih?', 'confirm');
            if (confirmed) {
                selectedClasses = [];
                updateAllUI();
                document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => { cb.checked = false; });
            }
        }
    });
    
    summaryContent.addEventListener('click', (event) => {
        if (event.target.classList.contains('remove-btn')) {
            const idToRemove = event.target.dataset.idUnik;
            const indexToRemove = selectedClasses.findIndex(c => c.id_unik === idToRemove);
            if (indexToRemove > -1) {
                selectedClasses.splice(indexToRemove, 1);
                updateAllUI();
                const checkbox = document.getElementById(idToRemove);
                if (checkbox) {
                    checkbox.checked = false;
                }
            }
        }
    });

    function timeToMinutes(timeStr) {
        const formattedTime = timeStr.replace('.', ':');
        const [hours, minutes] = formattedTime.split(':').map(Number);
        return hours * 60 + minutes;
    }

    function detectConflict(newClass, existingSchedule) {
        for (const scheduleStr of newClass.jadwal) {
            const [hari, waktu] = scheduleStr.split(', ');
            const [mulaiStr, selesaiStr] = waktu.split('-');
            const newStart = timeToMinutes(mulaiStr);
            const newEnd = timeToMinutes(selesaiStr);
            for (const existingClass of existingSchedule) {
                for (const existingScheduleStr of existingClass.jadwal) {
                    const [existingHari, existingWaktu] = existingScheduleStr.split(', ');
                    if (hari === existingHari) {
                        const [existingMulaiStr, existingSelesaiStr] = existingWaktu.split('-');
                        const existingStart = timeToMinutes(existingMulaiStr);
                        const existingEnd = timeToMinutes(existingSelesaiStr);
                        if (newStart < existingEnd && existingStart < newEnd) return existingClass;
                    }
                }
            }
        }
        return null;
    }

    function handleClassSelection(event) {
        const checkbox = event.target;
        const classId = checkbox.dataset.classId;
        const courseId = checkbox.dataset.courseId;
        const courseIndex = checkbox.dataset.courseIndex;
        const course = courseData[courseIndex];
        const selectedClassObj = { ...course.kelas.find(k => k.nama_kelas === classId) };
        selectedClassObj.sks = course.sks;
        selectedClassObj.nama_mk = course.nama_mk;
        selectedClassObj.kode_mk = course.kode_mk;
        selectedClassObj.id_unik = `${courseId}-${classId}`;
        const isCurrentlyChecked = selectedClasses.some(c => c.id_unik === selectedClassObj.id_unik);
        if (checkbox.checked && !isCurrentlyChecked) {
            const sameCourseConflict = selectedClasses.find(c => c.kode_mk === selectedClassObj.kode_mk);
            if (sameCourseConflict) {
                const indexToRemove = selectedClasses.findIndex(c => c.id_unik === sameCourseConflict.id_unik);
                selectedClasses.splice(indexToRemove, 1);
                document.getElementById(sameCourseConflict.id_unik).checked = false;
            }
            const timeConflict = detectConflict(selectedClassObj, selectedClasses);
            if (timeConflict) {
                showModal('Jadwal Tabrakan!', `Pilihan Anda bertabrakan dengan:<br><b>${timeConflict.nama_mk} (${timeConflict.nama_kelas})</b>`);
                checkbox.checked = false;
                if(sameCourseConflict) {
                    selectedClasses.push(sameCourseConflict);
                    document.getElementById(sameCourseConflict.id_unik).checked = true;
                }
                return;
            }
            selectedClasses.push(selectedClassObj);
        } else if (!checkbox.checked && isCurrentlyChecked) {
            const indexToRemove = selectedClasses.findIndex(c => c.id_unik === selectedClassObj.id_unik);
            if(indexToRemove > -1) selectedClasses.splice(indexToRemove, 1);
        }
        updateAllUI();
    }
    
    function updateAllUI() {
        localStorage.setItem('jadwalPilihan', JSON.stringify(selectedClasses));
        const totalSKS = selectedClasses.reduce((sum, cls) => sum + (cls.sks || 0), 0);
        renderSelectedClassesSummary(totalSKS);
        renderListView(totalSKS);
        renderCalendarView();
    }

    function renderSelectedClassesSummary(totalSKS) {
        summaryContent.innerHTML = '';
        selectedClasses.forEach(cls => {
            const item = document.createElement('div');
            item.className = 'selected-item';
            item.innerHTML = `
                <span>${cls.nama_kelas}</span>
                <span>${cls.jadwal.join('<br>')}</span>
                <span>${cls.sks}</span>
                <span>
                    <span class="remove-btn" data-id-unik="${cls.id_unik}" title="Hapus kelas ini">❌</span>
                </span>`;
            summaryContent.appendChild(item);
        });
        summarySksTotal.textContent = totalSKS;
    }

    function renderCourseList() {
        let html = '';
        const selectedIds = new Set(selectedClasses.map(c => c.id_unik));
        courseData.forEach((course, courseIndex) => {
            html += `<div class="course-card"><div class="course-header">${course.nama_mk} (${course.sks} SKS)</div><div class="course-subheader">Kode: ${course.kode_mk} | Term: ${course.term}</div>`;
            course.kelas.forEach(cls => {
                const fullId = `${course.kode_mk}-${cls.nama_kelas}`;
                const isChecked = selectedIds.has(fullId) ? 'checked' : '';
                const lecturersHtml = cls.pengajar.length > 0 ? cls.pengajar.join('<br>') : '-';
                const roomHtml = cls.ruang.length > 0 ? cls.ruang.join(', ') : '-';
                html += `<div class="class-item"><input type="checkbox" id="${fullId}" data-class-id="${cls.nama_kelas}" data-course-id="${course.kode_mk}" data-course-index="${courseIndex}"${isChecked}><label for="${fullId}" class="class-info"><strong>${cls.nama_kelas}</strong><span class="details">Jadwal: ${cls.jadwal.join(' | ')} <br> Ruang: ${roomHtml} <br> Pengajar: <br>${lecturersHtml}</span></label></div>`;
            });
            html += `</div>`;
        });
        courseListContainer.innerHTML = html;
        document.querySelectorAll('input[type="checkbox"]').forEach(c => c.addEventListener('change', handleClassSelection));
    }

    function renderListView(totalSKS) {
        listViewBody.innerHTML = '';
        if (selectedClasses.length === 0) {
            listViewBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Belum ada mata kuliah yang dipilih.</td></tr>`;
        } else {
            selectedClasses.forEach(cls => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${cls.nama_kelas}</td><td>${cls.jadwal.join('<br>')}</td><td>${cls.ruang.join('<br>')}</td><td>${cls.pengajar.join('<br>')}</td><td>${cls.sks || 0}</td>`;
                listViewBody.appendChild(row);
            });
        }
        listSksTotal.textContent = totalSKS;
    }

    // === FUNGSI KALENDER KEMBALI SEPERTI ASLINYA ===
    function renderCalendarView() {
        timetableElement.innerHTML = '';
        const days = ["Jam", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
        days.forEach(day => { timetableElement.innerHTML += `<div class="grid-header">${day}</div>`; });

        const startHour = 7, endHour = 22;

        for (let hour = startHour; hour < endHour; hour++) {
            const timeSlot = document.createElement('div');
            timeSlot.className = 'time-slot';
            timeSlot.textContent = `${hour.toString().padStart(2, '0')}.00`;
            const startRowForSlot = (hour - startHour) * 6 + 2;
            timeSlot.style.gridRow = `${startRowForSlot} / span 6`;
            timeSlot.style.gridColumn = '1';
            timetableElement.appendChild(timeSlot);

            const hourLine = document.createElement('div');
            hourLine.style.position = 'absolute';
            hourLine.style.borderBottom = '1px dotted var(--border-color)';
            hourLine.style.width = 'calc(100% - 60px)';
            hourLine.style.left = '60px';
            hourLine.style.top = `${39 + (hour - startHour) * 48 + 24 }px`;
            timetableElement.appendChild(hourLine);
        }

        const dayToGridColumn = { "Senin": 2, "Selasa": 3, "Rabu": 4, "Kamis": 5, "Jumat": 6, "Sabtu": 7 };
        selectedClasses.forEach(cls => {
            cls.jadwal.forEach(scheduleStr => {
                const [hari, waktu] = scheduleStr.split(', ');
                const [mulaiStr, selesaiStr] = waktu.split('-');
                const startMinutes = timeToMinutes(mulaiStr);
                const endMinutes = timeToMinutes(selesaiStr);
                const startRow = Math.floor((startMinutes - startHour * 60) / 10) + 2;
                const endRow = Math.ceil((endMinutes - startHour * 60) / 10) + 2;
                const column = dayToGridColumn[hari];

                if(column && startRow >= 2 && endRow > startRow) {
                    const block = document.createElement('div');
                    block.className = 'schedule-block';
                    block.style.gridColumn = `${column}`;
                    block.style.gridRow = `${startRow + 3} / ${endRow + 3}`;
                    block.innerHTML = `<div class="block-time">${mulaiStr} - ${selesaiStr}</div><div class="block-classname">${cls.nama_mk}</div><div class="block-room">Ruang: ${cls.ruang.join(', ')}</div>`;
                    timetableElement.appendChild(block);
                }
            });
        });
    }

    fetch('jadwal.json')
        .then(response => response.ok ? response.json() : Promise.reject(response.statusText))
        .then(data => {
            courseData = data;
            renderCourseList();
            updateAllUI();
        })
        .catch(error => {
            console.error('Gagal memuat JSON:', error);
            courseListContainer.innerHTML = `<p>Error: Gagal memuat file <strong>jadwal.json</strong>.</p>`;
        });

    updateSidebarButtonVisibility();
    window.addEventListener('resize', updateSidebarButtonVisibility);
});
</script>
</body>
</html>